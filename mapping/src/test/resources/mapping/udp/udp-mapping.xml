<?xml version="1.0" encoding="ISO-8859-1" ?>
<!--
  ~ Copyright(C) (2023) Sapper Inc. (open.source at zyient dot io)
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<configuration>
    <executor>
        <settings>
            <numThreads>4</numThreads>
            <taskQueueSize>32</taskQueueSize>
        </settings>
        <mappers>
            <factory>
                <contentDir>src/test/resources/mapping/udp/rules</contentDir>
                <mappings>
                    <test-document-node>doc-mapping.xml</test-document-node>
                    <test-page-node>page-mapping.xml</test-page-node>
                </mappings>
            </factory>
        </mappers>
        <contextProvider type="io.zyient.core.mapping.pipeline.impl.udp.UdpMappingContextProvider">
            <pipeline>udp_sample_base</pipeline>
        </contextProvider>
        <pipelines>
            <pipeline type="io.zyient.core.mapping.pipeline.impl.udp.UdpPipeline">
                <name>udp_sample_base</name>
                <responseType>io.zyient.core.mapping.pipeline.impl.udp.model.DocumentContextResponse</responseType>
                <pipelines>
                    <pipeline type="io.zyient.core.mapping.pipeline.impl.udp.nodes.DocumentStagingPipeline">
                        <name>udp_sample_document</name>
                        <responseType>io.zyient.core.mapping.pipeline.impl.udp.model.DocumentContextResponse
                        </responseType>
                        <context>
                            <reset>false</reset>
                            <add>true</add>
                            <key>udp.document</key>
                        </context>
                        <filter>
                            <json>
                                <path>
                                    <![CDATA[
                                    $.['documents[*]', 'documents']
                                ]]>
                                </path>
                            </json>
                        </filter>
                        <mapping>test-document-node</mapping>
                    </pipeline>
                    <pipeline type="io.zyient.core.mapping.pipeline.impl.udp.nodes.PageStagingPipeline">
                        <name>udp_sample_page</name>
                        <responseType>io.zyient.core.mapping.pipeline.impl.udp.model.PageContextResponse</responseType>
                        <context>
                            <reset>false</reset>
                            <add>true</add>
                            <key>udp.page</key>
                        </context>
                        <filter>
                            <json>
                                <path>
                                    <![CDATA[
                                    $.['pages[*]', 'pages']
                                ]]>
                                </path>
                            </json>
                        </filter>
                        <mapping>test-page-node</mapping>
                    </pipeline>
                </pipelines>
            </pipeline>
        </pipelines>
        <readers>
            <!--
            <factory>
                <defaults>
                    <type>[Reader Class]</type>
                </defaults>
            </factory>
            -->
            <reader type="io.zyient.core.mapping.readers.impl.json.JsonReaderConfig">
                <name>json-reader</name>
                <assumeFileType>JSON</assumeFileType>
                <readBatchSize>1024</readBatchSize>
                <type>DEFAULT</type>
                <isArray>false</isArray>
                <!--
                <override>
                    <delimiter>,</delimiter>
                    <escapeChar>\</escapeChar>
                    <quoteChar>"</quoteChar>
                    <recordSeparator>\n</recordSeparator>
                    <quoteMode>[ALL, ALL_NON_NULL, MINIMAL, NON_NUMERIC, NULL]</quoteMode>
                    <nullString>[String if value is NULL]</nullString>
                    <ignoreEmptyLines>true</ignoreEmptyLines>
                    <duplicateHeaders>[ALLOW_ALL, ALLOW_EMPTY, DISALLOW]</duplicateHeaders>
                </override>
                <columnPrefix>[IF no column names are defined or available]</columnPrefix>
                -->
            </reader>
        </readers>
    </executor>
</configuration>